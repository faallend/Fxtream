<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileStreamBot | {{file_name}}</title>
    <link rel="icon" href="https://i.ibb.co/Hh4kF2b/icon.png" type="image/x-icon">
    <link rel="shortcut icon" href="https://i.ibb.co/Hh4kF2b/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/sheryjs/dist/Shery.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/proavipatil/data@main/fs/src/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/proavipatil/data@main/fs/src/plyr.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <nav>
        <div class="nleft">
            <a href="#">
                <h3 id="heading" style="z-index: 100;" class="magnet title">FILE STREAM</h3>
            </a>
        </div>
        <div class="nryt">
            <a class="home-btn magnet" href="#main" onclick="toggleWidthnav(this)">HOME</a>
            <a href="#abtus" class="about-btn magnet" onclick="toggleWidthnav(this)">ABOUT</a>
        </div>
    </nav>
    
    <center>
        <div class="about-nav">
            <a href="#abtus" class="wlcm magnet" onclick="toggleWidth(this)">WELCOME</a>
            <a href="#channels" class="abt-chnl magnet" onclick="toggleWidth(this)">CHANNELS</a>
            <a href="#contact" class="magnet contact-btn" onclick="toggleWidth(this)">CONTACT</a>
        </div>
    </center>

    <div class="outer">
        <div class="inner">
            <div class="main" id="main">
                <video id="player" class="player" src="{{file_url}}" type="video/mp4" playsinline controls
                    width="100%"></video>
                <div class="file-name">
                    <h4 style="display: inline;">File Name: </h4>
                    <p style="display: inline;" id="myDiv">{{file_name}}</p><br>
                    <h4 style="display: inline;">File Size: </h4>
                    <p style="display: inline;">{{file_size}}</p>
                </div>
                
                <!-- Updated Download Section with Working Cloud Stream -->
                <div class="downloadBtn">
                    <div class="btn-group">
                        <button class="action-btn magnet" onclick="streamDownload()">
                            <img src="https://i.ibb.co/RjzYttX/dl.png" alt="Download">
                            DOWNLOAD VIDEO
                        </button>
                        
                        <button class="action-btn copy-link magnet" onclick="copyStreamLink()">
                            <img src="https://i.ibb.co/CM4Y586/link.png" alt="Copy">
                            COPY LINK
                        </button>

                        <div class="player-btns">
                            <!-- Cloud Stream Button with Fixed Implementation -->
                            <button class="action-btn player-btn magnet" onclick="cloudstream()">
                                <img src="https://i.ibb.co/7JfZsgbs/cloudstream.png" alt="CloudStream">
                                WATCH IN CLOUDSTREAM
                            </button>
                            
                            <!-- Other Player Buttons -->
                            <button class="action-btn player-btn magnet" onclick="vlc_player()">
                                <img src="https://i.ibb.co/px6fQs1/vlc.png" alt="VLC">
                                WATCH IN VLC PLAYER
                            </button>
                            
                            <button class="action-btn player-btn magnet" onclick="mx_player()">
                                <img src="https://i.ibb.co/41WvtQ3/mx.png" alt="MX Player">
                                WATCH IN MX PLAYER
                            </button>
                            
                            <button class="action-btn player-btn magnet" onclick="n_player()">
                                <img src="https://i.ibb.co/Hd2dS4t/nPlayer.png" alt="nPlayer">
                                WATCH IN NPLAYER
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Sections Remain Unchanged -->
            <!-- ... (keep existing about sections) ... -->
            
        </div>
        
        <footer>
            <!-- ... (keep existing footer content) ... -->
        </footer>
    </div>

    <!-- Scripts with Cloud Stream Fix -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sheryjs/dist/Shery.js"></script>
    
    <script>
    // Cloud Stream Function with Proper Implementation
    function cloudstream() {
        try {
            // Get the video URL from template variables
            const videoUrl = "{{file_url}}";
            
            // Validate URL format
            if (!videoUrl || !isValidUrl(videoUrl)) {
                throw new Error('Invalid video URL format');
            }

            // Encode the URL for safe transmission
            const encodedUrl = encodeURIComponent(videoUrl);
            
            // Construct the Cloud Stream URL
            const cloudStreamURL = `https://fxtream.onrender.com/watch/${encodedUrl}`;

            // Open in new window with fallback
            const newWindow = window.open(cloudStreamURL, '_blank');
            
            if (!newWindow || newWindow.closed) {
                window.location.href = cloudStreamURL;
            }
        } catch (error) {
            console.error('CloudStream Error:', error);
            alert(`Error: ${error.message}`);
        }
    }

    // URL Validation Helper
    function isValidUrl(string) {
        try {
            new URL(string);
            return true;
        } catch (_) {
            return false;
        }
    }

    // Existing Copy Function
    function copyStreamLink() {
        navigator.clipboard.writeText(window.location.href)
            .then(() => alert('Link copied to clipboard!'))
            .catch(err => console.error('Copy failed:', err));
    }

    // Initialize other functions as needed
    document.addEventListener("DOMContentLoaded", function() {
        // Your existing initialization code
    });
    </script>

    <!-- Keep other existing scripts -->
    <script src="https://cdn.plyr.io/3.6.9/plyr.js"></script>
    <script src="https://proavipatil.github.io/data/fs/src/script.js"></script>
</body>
</html>
```

